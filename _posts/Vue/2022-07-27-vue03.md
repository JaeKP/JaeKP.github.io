---
title: [Error]Vue3-routerì—ì„œ-ë„¤ë¹„ê²Œì´ì…˜-ê°€ë“œ-ì„¤ì •í•˜ëŠ”-ë°©ë²•
author: ë°•ì¬ê²½
date: 2022-07-23
categories: [WEB, Vue]
tag: [vue]
---

`ë„¤ë¹„ê²Œì´ì…˜ ê°€ë“œ` [ê³µì‹ë¬¸ì„œ](https://router.vuejs.org/guide/advanced/navigation-guards.html)

ë„¤ë¹„ê²Œì´ì…˜ ê°€ë“œë€ íŠ¹ì • í˜ì´ì§€ë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œì„œ URLì˜ ì ‘ê·¼ì„ ì œí•œí•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. 

<br>

## ğŸ˜¥ ë¬¸ì œ ìƒí™©

- ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ìœ ì €: `ê°œì¸ ì •ë³´ ìˆ˜ì •`, `íšŒì› íƒˆí‡´` í˜ì´ì§€ì— ì ‘ê·¼ì„ ëª»í•œë‹¤. 

- ë¡œê·¸ì¸ì„ í•œ ìœ ì €: `ë¡œê·¸ì¸`, `íšŒì›ê°€ì…` í˜ì´ì§€ì— ì ‘ê·¼ì„ ëª»í•œë‹¤.

<br>

íšŒì› ê´€ë¦¬ì— ê´€í•œ í˜ì´ì§€ë¥¼ ê°œë°œí•œ í›„, ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ì œí•œí•˜ë ¤ í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¡œê·¸ì¸ ì—¬ë¶€ ìì²´ë¥¼ ì¸ì‹í•˜ì§€ ëª»í–ˆë‹¤. 

<br>

### 1) ë¡œê·¸ì¸ ìœ ì €ì¸ì§€ í™•ì¸ì„ ëª»í•˜ë‚˜..?

`ë¡œê·¸ì¸ìœ ì € í™•ì¸ ë¡œì§`

- ë¡œê·¸ì¸ í–ˆì„ ë•Œ, ìœ ì €ì˜ accessí† í°ê³¼ refreshí† í°ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì™€ vuexì— ì €ì¥í•œë‹¤. 
- ë¸Œë¼ìš°ì €ë¥¼ ì¬ ì‹œì‘ í–ˆì„ ë•Œ, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— í† í° ì •ë³´ê°€ ìˆìœ¼ë©´ ì´ë¥¼ vuexì— ì €ì¥í•œë‹¤. 
- vuexì— í† í°ì´ ì €ì¥ë˜ì–´ ìˆì„ ê²½ìš° í•´ë‹¹ ìœ ì €ëŠ” ë¡œê·¸ì¸ ìœ ì €ë¡œ ê°„ì£¼í•œë‹¤. 

<br>

![image-20220729230058080](https://raw.githubusercontent.com/JaeKP/image_repo/main/img/image-20220729230058080.png)

vuexë¥¼ í™•ì¸í•´ë³´ë©´, ë¡œê·¸ì¸ ì—¬ë¶€ëŠ” ì˜ í™•ì¸í•˜ê³  ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. 

<br>

### 2) Router ì½”ë“œê°€ ë¬¸ì  ê°€..

```typescript
// src/router.ts 

import { computed } from "vue";
import { useStore } from "vuex"
const store = useStore()


// Navigation Guard ì„¤ì •: ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„ì˜ë¡œ anyíƒ€ì…ì„ ì‚¬ìš©í–ˆë‹¤. 
router.beforeEach((to: any, from, next) => {
  // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
  const isLoggedIn = computed(() => store.getters["personalInfo/isLoggedIn"]);

  // ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€
  const authPages = ["TheSignOutView", "TheChangeUserView", "TheChangePwView"];

  // ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì§€ ì•Šì„ ë•Œë§Œ ê°€ëŠ¥í•œ í˜ì´ì§€
  const notAuthPages = ["TheSignupView", "TheLoginView"];

  // 1. í˜„ì¬ ì´ë™í•˜ê³ ì í•˜ëŠ” í˜ì´ì§€ê°€ ë¡œê·¸ì¸ì´ í•„ìš”í•œì§€ í™•ì¸
  const isAuthRequired = authPages.includes(to.name);
  const isNotAuthRequired = notAuthPages.includes(to.name);

  // 2. ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì¸ë° ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ ë¡œê·¸ì¸ í˜ì´ì§€(/login)ë¡œ ì´ë™
  if (isAuthRequired && !isLoggedIn.value) {
    next({ name: "TheLoginView" });

    // 3. ë¡œê·¸ì¸ì´ ë˜ì–´ìˆëŠ”ë° /login, /signup í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤ë©´ ë©”ì¸ í˜ì´ì§€(/)ë¡œ ì´ë™
  } else if (isNotAuthRequired && isLoggedIn.value) {
    next({ name: "TheHomeView" });

    // 4.  ì›ë˜ ì´ë™ í˜ì´ì§€
  } else {
    next();
  }
});
```

router.tsì— ë„¤ë¹„ê²Œì´ì…˜ ê°€ë“œë¡œ ì‘ì„±í•œ ì½”ë“œê°€ ë¡œì§ì ì¸ ë¬¸ì œê°€ ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì•˜ë‹¤. 

1. í˜„ì¬ ìœ ì €ê°€ ë¡œê·¸ì¸ ìœ ì €ì¸ì§€ í™•ì¸í•œë‹¤.
2. ìœ ì €ì˜ ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼  ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì™€ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” í˜ì´ì§€ë¥¼ ë‚˜ëˆˆë‹¤.
3. í˜„ì¬ ì´ë™í•˜ê³ ì í•˜ëŠ” í˜ì´ì§€ê°€ ì–´ë–¤ í˜ì´ì§€ ì¸ì§€ í™•ì¸í•œë‹¤. 
   - í˜„ì¬ ì´ë™í•˜ê³ ì í•˜ëŠ” í˜ì´ì§€ê°€ ì–´ë””ì— ì†í•´ìˆëŠ”ì§€ `includes`í•¨ìˆ˜ë¥¼  í†µí•´ í™•ì¸ 
4. 1~3ì—ì„œ í™•ì¸í•œ `ìœ ì €ì˜ ë¡œê·¸ì¸ ì—¬ë¶€`ì™€ `ì´ë™í•˜ê³ ì í•˜ëŠ” í˜ì´ì§€ì˜ ì¢…ë¥˜`ì— ë”°ë¼ ì´ë™ë˜ëŠ” ë¶„ê¸°ê°€ ë‚˜ë‰œë‹¤. 
   - ê¶Œí•œì´ ì—†ëŠ” í˜ì´ì§€ì— ì´ë™í•˜ë ¤ê³  í•  ì‹œ, ì§€ì •ëœ í˜ì´ì§€ë¡œ ì´ë™
   - ê¶Œí•œì´ ìˆëŠ” í˜ì´ì§€ì— ì´ë™í•˜ë ¤ê³  í•  ì‹œ, ì›ë˜ ì´ë™í•˜ë ¤ê³  í•˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™

<br>

ë¡œì§ì€ í° ë¬¸ì œê°€ ì—†ëŠ” ê²ƒ ê°™ì€ë°.. ğŸ¤”

<br>

## ğŸ¤¸â€â™‚ï¸ í•´ê²° ë°©ë²•

ìœ„ì˜ ì½”ë“œì—ì„œ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

<br>

```typescript
// src/router.ts 

const isLoggedIn = computed(() => store.getters["personalInfo/isLoggedIn"]);
console.log(isLoggedIn)
```

consoleì— ì°ì–´ë³´ë‹ˆ `undefined`ê°€ ì¶œë ¥ ë˜ì–´ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ëŠ” ê²ƒì´ë‹¤. ë¶„ëª… storeì—ëŠ” ê°’ì´ ì˜ ì €ì¥ë˜ì–´ ìˆëŠ”ë° ì™œ ê°’ì„ ëª» ê°€ì ¸ì˜¤ëŠ” ê±¸ê¹Œ. 

ê¸°ì¡´ì— ì»´í¬ë„ŒíŠ¸ì—ì„œ storeë¥¼ ì ‘ê·¼í•  ë•ŒëŠ” `useStore`ë¼ëŠ” ë©”ì„œë“œë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—  ì™¸ë¶€ tsíŒŒì¼ë„ ì´ë ‡ê²Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•  ê²ƒì´ë¼ê³  ìƒê°í–ˆì—ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê°™ì€ ì½”ë“œë¡œ ì ‘ê·¼í•˜ë©´ ì•ˆëœë‹¤.

<br>

````typescript
// src/main.ts
import { createApp } from "vue";
import App from "./App.vue";
import router from "./router";
import store from "./store";

const app = createApp(App);
app.use(store).use(router);
app.mount("#app");
````

- vueëŠ” ì´ë ‡ê²Œ main.tsì—ì„œ storeê°€ ì—°ë™ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— `{useStore}`ë©”ì„œë“œë¡œ ì ‘ê·¼ì„ í•  ìˆ˜ ìˆë‹¤. (ì¶”ì¸¡..) 
- ê·¸ë˜ì„œ vueíŒŒì¼ì´ ì•„ë‹Œ ì™¸ë¶€ íŒŒì¼ì—ì„œ ì ‘ê·¼ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ì§ì ‘ storeì— ì ‘ê·¼í•´ì„œ storeë¥¼ ê°€ì ¸ì™€ì•¼ í•œë‹¤. 

<br>

```typescript
// src/store/index.ts

import { createStore } from "vuex";
import { account, AccountState } from "../store/accounts/account";
import { signup, SignupState } from "../store/accounts/signup";
import { password, PasswordState } from "../store/accounts/password";
import { personalInfo, PersonalInfoState} from "../store/accounts/personalInfo";


// ëª¨ë“ˆì˜ stateë¥¼ ê³µìœ í•œë‹¤.
export interface RootState {
  account: AccountState;
  signup: SignupState;
  personalInfo: PersonalInfoState;
  password: PasswordState;
}

// storeë¥¼ ìƒì„±í•œë‹¤.
export default createStore({
  modules: {
    account,
    signup,
    personalInfo,
    password,
  },
});

```

- storeë¥¼ `createStore`ë¥¼ í†µí•´ exportí•˜ê³  ìˆê¸° ë•Œë¬¸ì— `createStore`ë¡œ vuexì˜ storeì— ì ‘ê·¼í•˜ë©´ ëœë‹¤. 

<br>

```typescript
import { computed } from "vue";
import createStore from "../src/store/index";

// ìŠ¤í† ì–´ ì •ì˜
const store = createStore;

// Navigation Guard ì„¤ì •: ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„ì˜ë¡œ anyíƒ€ì…ì„ ì‚¬ìš©í–ˆë‹¤. 
router.beforeEach((to: any, from, next) => {
  const isLoggedIn = computed(() => store.getters["personalInfo/isLoggedIn"]);

  const authPages = ["TheSignOutView", "TheChangeUserView", "TheChangePwView"];
  const notAuthPages = ["TheSignupView", "TheLoginView"];

  const isAuthRequired = authPages.includes(to.name);
  const isNotAuthRequired = notAuthPages.includes(to.name);

  if (isAuthRequired && !isLoggedIn.value) {
    next({ name: "TheLoginView" });
    console.log("ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ìœ ì €ëŠ” ëŒì•„ê°€ì‹œì˜¤")
  } else if (isNotAuthRequired && isLoggedIn.value) {
    next({ name: "TheHomeView" });
  } else {
    next();
  }
});
```

ë¬¸ì œ ì—†ì´ ì˜ ì‘ë™ í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ ğŸ˜€

<br>

![image-20220731120805602](https://raw.githubusercontent.com/JaeKP/image_repo/main/img/image-20220731120805602.png)

<br>
