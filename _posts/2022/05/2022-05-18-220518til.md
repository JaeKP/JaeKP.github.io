---
title: 22/05/18/ìˆ˜ Vue ì‘ìš©, 1í•™ê¸° ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸- API
author: ë°•ì¬ê²½
date: 2022-05-18
categories: [TIL/2022, "05"]
tag: [til, vue, django, project, MovieWiki]
---

# 220517 Today I learned!

- [x] Vue ì‘ìš”
- [x] 1í•™ê¸° ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸

---

## 1. Fact 

### (1)  Vue ì‘ìš©

- Navigation Guard: ì „ì—­ê°€ë“œ 
- Vuex Module 
- Vue Component êµ¬ì„±
- ì„œë²„ì™€ì˜ í†µì‹ ì„ í†µí•œ article, comment, account êµ¬í˜„

<br>

### (2) 1í•™ê¸° ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸

- Articleê²Œì‹œíŒ í•„í„° API
  - ì¸ê¸°ê²Œì‹œíŒ (7ì¼ì´ë‚´ ì¸ê¸°ìˆœ)
  - ììœ ê²Œì‹œíŒ, ì˜í™”ê²Œì‹œíŒ, ë°°ìš° ê²Œì‹œíŒ

- ArticleComment API
  - CRUD API 
  - ì¢‹ì•„ìš” API 
- Userê´€ë ¨ APIì™€ Serializer
  - íšŒì›ê°€ì… Serializer ì¬ ì •ì˜
  - í”„ë¡œí•„ í˜ì´ì§€, íšŒì›ì •ë³´ ìˆ˜ì • API 
- [í”„ë¡œì íŠ¸ ê¹ƒí—ˆë¸Œ](https://github.com/JaeKP/MovieWiki)
- [í”„ë¡œì íŠ¸ ë…¸ì…˜](https://evanescent-tuba-146.notion.site/d71f0e701e314d7abfcf72ede38fe8b6)

<br>

## 2. Feeling

ì˜¤ëŠ˜ì€ ì •ë§ ì •ì‹ ì´ ì—†ì—ˆë‹¤. ë§ˆì§€ë§‰ vue ìˆ˜ì—…ì´ê¸° ë•Œë¬¸ì— ì½”ë“œë¥¼ ë”°ë¼ì¹  ì‹œê°„ë„ ì—†ì´ ì§„ë„ê°€ ì§„í–‰ë˜ì—ˆë‹¤. í”„ë¡œì íŠ¸ì—ì„œ ì§ì ‘ êµ¬í˜„í•´ë³´ë©´ì„œ í•´ë‹¹ ë‚´ìš©ì„ í•™ìŠµí•´ì•¼ í•  ê²ƒ ê°™ë‹¤. 

í”„ë¡œì íŠ¸ëŠ” ì˜ ì§„í–‰ë˜ê³  ìˆë‹¤. ë‚´ì¼ ë°±ì—”ë“œë¥¼ ì–´ëŠì •ë„ ì™„ì„±í•˜ëŠ” ê²ƒì´ ëª©í‘œì´ë‹¤. ì˜¤ë¥˜ë„ ë§ì´ ë°œìƒí•˜ê³  Serializerì— ë¨¸ë¦¬ê°€ ë§ì´ ì•„í”„ì§€ë§Œ,...ğŸ™ƒ 

**`ì•„ì‰¬ìš´ ì `** 

1. íšŒì›ì •ë³´ ìˆ˜ì •ì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì •í•˜ì§€ ëª»í–ˆë‹¤. 
2. íšŒì› íƒˆí‡´ë¥¼ êµ¬í˜„í•˜ì§€ ëª»í–ˆë‹¤. 

<br>

## 3. Finding 

> ë„ˆë¬´ ê³¼í•œ ëª¨ë“ˆí™”ëŠ” í•˜ì§€ ë§ì.
{: .prompt-info }

Serializer ì˜¤ë²„ë¼ì´ë“œë¥¼ í•  ë•Œ ê³¼í•œ ëª¨ë“ˆí™”ëŠ” ë…ì´ ëœë‹¤.  `most likely due to a circular import`ì—ëŸ¬ê°€ ê³„ì† ë°œìƒí•´ì„œ ì§„í–‰ì´ ë”ëŒì¡ŒëŠ”ë°, Serializerê°€ ê³„ì† ì˜¤ë²„ë¼ì´ë“œê°€ ë˜ë‹¤ë³´ë‹ˆ ì„œë¡œ ì°¸ì¡°ê°€ ë˜ëŠ” ìƒí™©ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë°œìƒí•˜ê²Œ ë˜ì–´ ì˜¤ë¥˜ê°€ ê³„ì† ë°œìƒí–ˆë‹¤. ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³´ê¸° ì‹«ì€ ì½”ë“œê°€ ë‚˜ì™”ë‹¤ ğŸ˜¥

```python
from rest_framework import serializers
from movies.serializers.movie import MovieListSerializer
from movies.serializers.movie_review import ProfileMovieReviewSerializer
from articles.serializers.article_comment import ProfileArticleCommentSerializer
from articles.models import Article, ArticleType
from django.contrib.auth import get_user_model
User = get_user_model()

class UserProfileSerializer(serializers.ModelSerializer):
    class ProfileArticleSerializer(serializers.ModelSerializer):
        class ArticleTypeSerializer(serializers.ModelSerializer):
            class Meta:
                model = ArticleType
                fields = ('pk', 'name')
        article_type = ArticleTypeSerializer(read_only=True)
        like_count = serializers.IntegerField(source="like_users.count", read_only=True)

        class Meta:
            model = Article
            fields = ('pk', 'article_type', 'title', 'content', 'created_at', 'article_type','like_count',)
    like_movies = MovieListSerializer(many=True, read_only=True)
    article = ProfileArticleSerializer(many=True, read_only=True)
    comment = ProfileArticleCommentSerializer(many=True, read_only=True)
    review = ProfileMovieReviewSerializer (many=True, read_only=True)
    class Meta:
        model = User
        fields = ('pk', 'nickname', 'region', 'age', 'profile_image','like_movies',  'article',  'comment',  'review',)
```

í•˜ë‚˜ì˜ Serailizerì— ëª¨ë“ˆì„ í†µí•œ ì°¸ì¡°ì™€ ì§ì ‘ ì°¸ì¡°í•˜ëŠ” ê²ƒì´ ì„ì¸ ìƒí™©...ì´ë‹¤.. í”„ë¡œì íŠ¸ ì§„í–‰í•  ì‹œê°„ì´ ì´‰ë°•í•´ì„œ ë”°ë¡œ ìˆ˜ì •í•˜ì§€ ì•Šê³  ë„˜ì–´ê°€ì§€ë§Œ, ë‚˜ì¤‘ëŠ” ê¼­..!!

ë‹¤ìŒì—ëŠ” ë°˜ë³µë˜ëŠ” ì½”ë“œê°€ ë§ë”ë¼ë„, circular importì—ëŸ¬ë°©ì§€ì™€ ì½”ë“œì˜ ê°€ë…ì„±ì„ ìœ„í•´ ì§ì ‘ì°¸ì¡°ë§Œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ê²ƒì´ë‹¤. 

<br>

> DJangoì—ì„œëŠ” datetime.now()ë³´ë‹¤ëŠ” timezone.now()ë¥¼ ì¨ì•¼ í•œë‹¤. 
>
> {: .prompt-info }

1ì£¼ì¼ì´ë‚´ ì‘ì„±ëœ ê¸€ì„ í•„í„°ë§ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë¨¼ì € `datetime.now()`ë¥¼ í™œìš©í•˜ì—¬ í˜„ì¬ ì‹œê°ì„ êµ¬í•˜ë ¤ í–ˆë‹¤. 

```python
now = datetime.now()
    before_one_week = now - timedelta(weeks=1)
    now = now.strftime('%Y-%m-%d')
    since = before_one_week.strftime('%Y-%m-%d')
articles = Article.objects.filter(created_at__range=[since, now])
```

ê·¸ëŸ°ë°, `warnings.warn("DateTimeField %s received a naive datetime (%s)`ë¼ëŠ” ê²½ê³ ê°€ í„°ë¯¸ë„ì°½ì— ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. [ì°¸ê³ ë¸”ë¡œê·¸ ](https://it-eldorado.tistory.com/13)

**datetime ê°ì²´ì˜ ì¢…ë¥˜ëŠ” í¬ê²Œ Navie ê°ì²´(timezone ì •ë³´ë¥¼ í¬í•¨í•˜ì§€ ì•ŠëŠ” datetime)ì™€ Aware ê°ì²´(timezone ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” datetime)ê°€ ìˆë‹¤.** 

í˜„ì¬ Settings.pyì—ì„œ `Use_TZ=True`ë¡œ ì„¤ì •ì„ í–ˆê¸°ë¬¸ì— Aware datetime ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ë°, í˜„ì¬ ì‹œê°„ì„ êµ¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œ datetime.now()ëŠ” Navie datetime ê°ì²´ì´ë‹¤. 

ì¦‰, ì´ ë‘˜ì˜ ì°¨ì´ ë•Œë¬¸ì— ê²½ê³ ë¥¼ í•˜ëŠ” ê²ƒì´ë‹¤. í˜¸í™˜ì„±ì„ ìœ„í•´ Naive datetime ê°ì²´ë¥¼ ì‚¬ìš©í•´ë„ Awatr datetime ê°ì²´ë¡œ ë³€í™˜í•˜ì§€ë§Œ ë‹¤ë¥¸ ë¬¸ì œê°€ ë°œìƒí•  ì—¬ì§€ê°€ ìˆê¸° ë•Œë¬¸ì— ê²½ê³ ë¥¼ ë„ì›Œì¤€ë‹¤. 

```python
# í•´ê²° ë°©ì•ˆ: timezone.now()í™œìš©
now = timezone.now()
articles = Article.objects.filter(created_at__range=[now-timedelta(days=6), now])
```

<br>

> annotateë¥¼ í™œìš©í•˜ì—¬ ìƒˆë¡œìš´ í•„ë“œë¥¼ ë§Œë“¤ê³   ì´ë¥¼ ì´ìš©í•˜ì—¬ ì •ë ¬ì„ í•  ìˆ˜ ìˆë‹¤.
{: .prompt-info }

ì¢‹ì•„ìš”ê°€ ë§ì€ ìˆœì„œì— ë”°ë¼ ë°ì´í„°ë¥¼ ì •ë ¬ì„ í•´ì•¼ í–ˆë‹¤. í•˜ì§€ë§Œ modelì—ëŠ” ì¢‹ì•„ìš”ë¥¼ í•œ ì‚¬ëŒë“¤ì— ëŒ€í•œ ì •ë³´ëŠ” ìˆì§€ë§Œ ìˆ«ìë¥¼ ê¸°ë¡í•˜ëŠ” í•„ë“œê°€ ì§€ì •ë˜ì§€ëŠ” ì•Šì•˜ë‹¤. 

ê·¸ë˜ì„œ annotateë¥¼ í†µí•´ ìƒˆë¡œìš´ í•„ë“œë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ í†µí•´ ì¢‹ì•„ìš”ê°€ ë§ì€ ìˆœì„œë¡œ ì •ë ¬ì„ í•  ìˆ˜ ìˆì—ˆë‹¤. 

```	python
# ìµœê·¼ 1ì£¼ì¼ ê²Œì‹œê¸€, ì¢‹ì•„ìš” ìˆœìœ¼ë¡œ ë‚˜ì—´
    articles = Article.objects.filter(
        created_at__range=[now-timedelta(days=6), now]
    ).annotate(
        like_count=Count('like_users', distinct=True)
    ).order_by('-like_count')
```

<br>

## 4. Future Action & Feedback

| Future Action  | ì§„í–‰ ìƒí™©    | Feedback   |
| -------------- | ------------ | ---------- |
| DOMì„ ê¹¨ìš°ì¹˜ë‹¤ | `pause ğŸ¤¦â€â™€ï¸`   | ì ì‹œ ì¤‘ë‹¨! |
| why ë¦¬ì•¡íŠ¸?    | `Not StartğŸŒ™` |            |

<br>
