---
title: 22/05/19/ëª© Vue ì‘ìš©, 1í•™ê¸° ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸- API
author: ë°•ì¬ê²½
date: 2022-05-19
categories: [TIL/2022, May]
tag: [til, vue, django, 1í•™ê¸° ê´€í†µ í”„ë¡œì íŠ¸, MovieWiki]
---

# 220519 Today I learned!

- [x] 1í•™ê¸° ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸

---

## 1. Fact 

### (1) 1í•™ê¸° ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸

- íŠ¸ë ˆì¼ëŸ¬ í˜ì´ì§€ API 
- profile_imge í•„ë“œ ìˆ˜ì •
- íšŒì› ê°€ì… ì‹œ ê¸°ì…í•œ ì •ë³´ê°€ DBì— ì €ì¥ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ë¥¼ ìˆ˜ì •í–ˆë‹¤.
- MovieReview API
  - ìµœì‹ ìˆœ, ì¸ê¸°ìˆœ í•„í„°
  - CRUD
  - í”„ë¡œí•„ í˜ì´ì§€, íšŒì›ì •ë³´ ìˆ˜ì • API 

- ì˜í™” ì¶”ì²œ API
  - ìµœê·¼ ê°œë´‰ ì¸ê¸° ì˜í™” (50ì¼ ì´ë‚´ ê°œë´‰, ì¸ê¸°ë„ ìˆœìœ¼ë¡œ ì •ë ¬)
  - ìš”ì¦˜ ì œì¼ ê´€ì‹¬ ë°›ëŠ” ì˜í™” (30ì¼ë‚´ì— ì‘ì„±ëœ ë¦¬ë·°ê°€ ë§ì€ ì˜í™”)
  - ê³„ì ˆ ì¶”ì²œ ì˜í™” (ê³„ì ˆë³„ íŠ¹ì •ì˜ ì¸ê¸° ìˆëŠ” ì˜í™”ë¥¼ ì¶”ì²œ)

- Vue ì´ˆê¸° ì…‹íŒ…
- [í”„ë¡œì íŠ¸ ê¹ƒí—ˆë¸Œ](https://github.com/JaeKP/MovieWiki)
- [í”„ë¡œì íŠ¸ ë…¸ì…˜](https://evanescent-tuba-146.notion.site/d71f0e701e314d7abfcf72ede38fe8b6)

<br>

## 2. Feeling

ì–´ì œ êµ¬í˜„í•˜ì§€ ëª»í•œ íšŒì› íƒˆí‡´ë¥¼ êµ¬í˜„í–ˆë‹¤. `settings.py`ì˜ installed appì— ë¹ ì§„ ë‚´ì—­ì´ ìˆì–´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë˜ ê²ƒì´ë‹¤ ã… ã…  ìš”ì¦˜ ì™œë§í‹€~ì„ ì™œì¹˜ë©´ì„œ ì˜¤ë¥˜ë¥¼ ì°¾ëŠ” ë° ë°”ì˜ë‹¤. ê·¸ë˜ë„ ì˜¤ëŠ˜ ë°±ì—”ë“œëŠ” ëì´ë‚¬ê³  ë‚´ì¼ë¶€í„° í”„ë¡ íŠ¸ ì—”ë“œë¥¼ ì‹œì‘í•  ê²ƒ ê°™ë‹¤. ê³¼ì—° ë‚´ê°€ ê¸°íší–ˆë˜ ê²ƒë“¤ì„ ì „ë¶€ êµ¬í˜„í•  ìˆ˜ ìˆì„ì§€ ëª¨ë¥´ê² ì§€ë§Œ,,,,

Vueì— ëŒ€í•œ ì‹¤ë ¥ì´ ë¯¸ìˆ™í•œ ê²ƒì€ ëˆ„êµ¬ë³´ë‹¤ ì•Œì§€ë§Œ í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ë§ì´ ë°°ì›Œê°ˆ ìˆ˜ ìˆì„ ê±°ë¼ëŠ” ìƒê°ì´ ë“ ë‹¤.    

<br>

## 3. Finding 

> django ormì€ ì‹ ì´ë‹¤....
{: .prompt-info }

- annotateë¡œ ìƒì„±í•œ ì—´ì„ filterë¡œ ì¡°ê±´ì„ ì¤„ ìˆ˜ ìˆë‹¤. ë˜í•œ, `__`ë¥¼ í™œìš©í•˜ë©´ ì—­ì°¸ì¡° ëª¨ë¸ì˜ ë‹¤ë¥¸ í•„ë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. 

```python
now = timezone.now()
movies = Movie.objects.annotate(
    review_count=Count(
        'review', distinct=True, filter = Q(
            review__created_at__range=[now-timedelta(days=30), now]
        ))).order_by('-review_count')[:21]
serializer = MovieListSerializer(movies, many=True)
return Response(serializer.data)
```

annotateë¥¼ í†µí•´ review_count columnì„ ìƒì„±í•˜ê³  ìƒì„±í•œ ì—´ì„ created_at ë²”ìœ„ë¡œ filterì„¤ì •ì„ ì¤€ë‹¤. 

ê·¸ ê²°ê³¼, 30ì¼ ì´ë‚´ reivewë¥¼ ì‘ì„±í•œ ìˆ˜ê°€ ë§ì€ ì˜í™”ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤. 

<br>

- `order_by('?')`ëŠ” ëœë¤ìœ¼ë¡œ ì •ë ¬í•œ ê²°ê³¼ë¥¼ ë„ì¶œí•œë‹¤. 

```python
        now = int(timezone.now().strftime('%m'))
        if now == 3 or now == 4 or now == 5:
            season = 'spring'
        elif now == 6 or now == 7 or now == 8:
            season = 'summer'
        elif now == 9 or now == 10 or now == 12:
            season = 'fall'
        else:
            season = 'winter'
        season_code = {
            'spring': 10749, 'summer': 27, 'fall': 12, 'winter': 14
        }
        genre_id = season_code.get(season)
        movies = Movie.objects.filter(genre_ids=genre_id, popularity__gt=99).order_by('?')[:21]
        serializer = MovieListSerializer(movies, many=True)
        return Response(serializer.data)
```

ë„ˆë¬´ ì¸ê¸°ë„ë¡œë§Œ ì •ë ¬ í•˜ë©´ ê²¹ì¹˜ëŠ” ì¶”ì²œì˜í™”ê°€ ë§ì„ ê²ƒì„ ì˜ˆìƒí–ˆë‹¤. ê·¸ë˜ì„œ ì¸ê¸°ë„ì˜ í•˜í•œì„ ì„ ì •í•œë’¤, ëœë¤ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ë‚¸ë‹¤. 

<br>

- `~Q()`ì€ not~ê³¼ ê°™ë‹¤. 

```python
movie = Movie.objects.filter(~Q(trailer_youtube_key='nothing') ,popularity__gt=99).order_by('?')
serializer = MovieTrailerSerializer(movie, many=True)
return Response(serializer.data)    
```

`~Q(trailer_youtube_key='nothing'` => trailer_youtube_keyê°€ ìˆëŠ” ê²½ìš°ë¥¼ ì˜ë¯¸í•œë‹¤. (ë°ì´í„°ë¥¼ ë°›ì„ ë•Œ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìœ¼ë©´  'nothing'ë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.) 

ì¦‰, trailer_youtube_keyê°€ ìˆê³  ì¸ê¸°ë„ê°€  99ë¥¼ ë„˜ëŠ” ì˜í™”ë¥¼ ëœë¤ìœ¼ë¡œ ì •ë ¬í•œë‹¤. 

<br>

> URLì„ ì¡°ì‹¬í•˜ì...!
{: .prompt-info }

/api/v1/accounts/login, signupì´ ë˜ì§€ ì•Šì•„ ê³¨ì¹˜ê°€ ë§ì´ ì•„íŒ ë‹¤. ê°‘ìê¸° ìê²© ì¸ì¦ë°ì´í„°(authentication credentials)ê°€ ì œê³µë˜ì§€ ì•Šì•„ì„œ ì ‘ê·¼í•  ìˆ˜ ì—ˆë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. loginê³¼ signupë‹¨ê³„ì—ì„œëŠ” ë‹¹ì—°íˆ í† ê·¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ëŠ”ë°, ì™œ ì´ëŸ´ê¹Œ ê³ ë¯¼í–ˆë‹¤. 

**ê·¸ëŸ°ë°! ë‚˜ì˜ ë¹›ê³¼ ì†Œê¸ˆê³¼ ê°™ì€ í”„ì—” ìŠ¤í„°ë”” ì¹œêµ¬ë“¤ì´ ë„ì›€ì„ ì£¼ì—ˆë‹¤.** 



```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/movie/', include('movies.urls')),
    path('api/v1/article/', include('articles.urls')),
    path('api/v1/accounts/', include('dj_rest_auth.urls')), 
    path('api/v1/accounts/signup/', include('dj_rest_auth.registration.urls')),
    
    # í”„ë¡œí•„ë¡œ ê°€ëŠ” url ë’¤ì— <str:username>ì´ ë¶™ì„ ì˜ˆì •ì´ë‹¤. 
    path('api/v1/accounts/', include('accounts.urls')),

]
```

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ `path('api/v1/accounts/', include('accounts.urls'))`ë¥¼ ê°€ì¥ ë§¨ë’¤ë¡œ ë³´ë‚´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. 

ë§Œì•½ ìƒë‹¨ì— ë°°ì¹˜í•œë‹¤ë©´, í•´ë‹¹ urlì€ ë’¤ì— `<str:username>`ì´ ë¶™ê¸° ë•Œë¬¸ì—  api/v1/accounts/login í˜¹ì€ api/v1/accounts/signip/ì˜ ë’·ë¶€ë¶„ì´ ë¬¸ìì—´ë¡œ ì¸ì‹ëœë‹¤.

ê·¸ ê²°ê³¼, ë‚´ê°€ ìƒê°í–ˆë˜ viewí•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì„ ê²ƒì´ë‹¤. ë˜í•œ, ìœ„ì˜ urlì˜ ë¬¸ì œì ì€ signupì´ë¼ëŠ” ì•„ì´ë””ë¥¼ ê°€ì§„ ì‚¬ëŒì€ ìì‹ ì˜ í”„ë¡œí•„ í˜ì´ì§€ì— ì ˆëŒ€ ê°€ì§€ ëª»í•œë‹¤. ğŸ˜… ê·¸ë˜ì„œ ê²°êµ­ `api/v1/accounts/profile/<str:username>`ìœ¼ë¡œ ìˆ˜ì •í–ˆë‹¤. 

<br>

## 4. Future Action & Feedback

| Future Action  | ì§„í–‰ ìƒí™©    | Feedback   |
| -------------- | ------------ | ---------- |
| DOMì„ ê¹¨ìš°ì¹˜ë‹¤ | `pause ğŸ¤¦â€â™€ï¸`   | ì ì‹œ ì¤‘ë‹¨! |
| why ë¦¬ì•¡íŠ¸?    | `Not StartğŸŒ™` |            |

<br>
