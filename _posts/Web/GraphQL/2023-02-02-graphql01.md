---
title: GraphQL-ê¸°ì´ˆ
author: ë°•ì¬ê²½
date: 2023-02-02
categories: [WEB, GraphQL]
tag: [GraphQL]
---



[ê³µì‹ ë¬¸ì„œ](https://graphql-kr.github.io/)

<br>

# 1. GraphQLì´ë€

GraphQLì€ SQLê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¿¼ë¦¬ ì–¸ì–´ ì¤‘ í•˜ë‚˜ì´ë‹¤.

- SQL:  ë°ì´í„° ë² ì´ìŠ¤ ì‹œìŠ¤í…œì— ì €ì¥ëœ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ëª©ì 
- GraphQL:ì›¹ í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ë¥¼ ì„œë²„ë¡œë¶€í„° íš¨ìœ¨ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ëª©ì 

**ì¦‰, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°„ í†µì‹ ì„ ìœ„í•´ ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.** 

<br>

## 1) ì¥ì 

- í•„ìš”í•œ ì •ë³´ë§Œ ì„ íƒí•˜ì—¬ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.
  -  RESTAPIì˜ **Overfetching** ë¬¸ì œ í•´ê²°
  - ë°ì´í„° ì „ì†¡ëŸ‰ ê°ì†Œ
- ì—¬ëŸ¬ ê³„ì¸µì˜ ì •ë³´ë“¤ì„ í•œ ë²ˆì— ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.
  -  RESTAPIì˜ **Underfetching** ë¬¸ì œ í•´ê²°
  - ìš”ì²­ íšŸìˆ˜ ê°ì†Œ
- í•˜ë‚˜ì˜ Endpointì—ì„œ ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•œë‹¤.
  - í•˜ë‚˜ì˜ URIì—ì„œ POSTë¡œ ëª¨ë“  ìš”ì²­ì´ ê°€ëŠ¥í•˜ë‹¤. 

<br>

## 2) Apollo

GraphQLì€ RESPAPIì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ í†µì‹ ì„ ì›í•  í•˜ê²Œ ìœ„í•œ ëª…ì„¸ì¼ ë¿ì´ë‹¤.

ê·¸ë˜ì„œ GraphQLì„ êµ¬í˜„í•  ì†”ë£¨ì…˜ì´ í•„ìš”í•˜ë‹¤. ê·¸ ì¤‘ í•˜ë‚˜ì˜ ì†”ë£¨ì…˜ì´ Apolloì´ë‹¤. 

- ë°±ì—”ë“œì—ì„œ ì •ë³´ë¥¼ ì œê³µ ë° ì²˜ë¦¬

- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìš”ì²­ì„ ì „ì†¡

<br>

# 2. Apollo ì„œë²„ êµ¬ì¶•í•˜ê¸°

[ê³µì‹ ë¬¸ì„œ](https://www.apollographql.com/docs/apollo-server/api/apollo-server/)

```javascript
const database = require('./database')
const { ApolloServer, gql } = require('apollo-server')

// typeDef: GraphQL ëª…ì„¸ì—ì„œ ì‚¬ìš©ë  ë°ì´í„°ì˜ íƒ€ì… (schema), ìš”ì²­ì˜ íƒ€ì…ì„ ì§€ì •í•œë‹¤.
// gql(template literal tag)ë¡œ ìƒì„±ëœë‹¤. 
const typeDefs = gql`
  type Query {
    teams: [Team] 
  }
  type Team {
    id: Int
    manager: String
    office: String
    extension_number: String
    mascot: String
    cleaning_duty: String
    project: String
  }
`
// resolver: ì„œë¹„ìŠ¤ì˜ ì•¡ì…˜ë“¤ì„ í•¨ìˆ˜ë¡œ ì§€ì •í•œë‹¤. 
// ìš”ì²­ì— ë”°ë¼ ë°ì´í„°ë¥¼ ë°˜í™˜, ì…ë ¥, ìˆ˜ì •, ì‚­ì œí•œë‹¤. 
const resolvers = {
  // teamsë¥¼ ìš”ì²­í•˜ë©´, databaseì˜ teamì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤. 
  Query: {
    teams: () => database.teams
  }
}

// ApolloServer í´ë˜ìŠ¤ëŠ” typeDefsì™€ resiolversë¥¼ ì¸ìë¡œ ë°›ì•„ì„œ ì„œë²„ë¥¼ ìƒì„±í•œë‹¤.
const server = new ApolloServer({ typeDefs, resolvers })
server.listen().then(({ url }) => {
  console.log(`ğŸš€  Server ready at ${url}`)
})
```

<br>

typeDefì— ëŒ€í•´ ì¢€ ë” ìì„¸íˆ ì‚´í´ë³´ë©´ Queryì˜ **ë£¨íŠ¸ íƒ€ì…**ì´ ì§€ì •ë˜ì–´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```javascript
// Queryë¡œ teamsì„ ìš”ì²­í•˜ë©´ Teamì˜ ë°°ì—´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤ (ìš”ì²­ì— ëŒ€í•œ íƒ€ì…)
type Query {
    teams: [Team] 
}

// Teamì˜ íƒ€ì…ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (ë°ì´í„°ì— ëŒ€í•œ íƒ€ì…)
type Team {
    id: Int
    manager: String
    office: String
    extension_number: String
    mascot: String
    cleaning_duty: String
    project: String
}
```

<br>

## 1) Schemas and Types

[ê³µì‹ ë¬¸ì„œ](https://graphql.org/learn/schema/)

GraphQLì—ì„œ ë°ì´í„°ì˜ íƒ€ì…ì„ ì§€ì •í•  ë•Œ, ì‚¬ìš©ë˜ëŠ” íƒ€ì…ë“¤ì€ ì •í•´ì ¸ìˆë‹¤. 

ìš°ì„ , GraphQL ìŠ¤í‚¤ë§ˆì˜ **ê°€ì¥ ê¸°ë³¸ì ì¸ êµ¬ì„± ìš”ì†ŒëŠ” ê°ì²´ ìœ í˜•ì´ë‹¤.** ê·¸ ì™¸ì—ë„ ê¸°ë³¸ì ì¸ íƒ€ì…ë“¤ì´ ë‹¤ìŒê³¼ ê°™ì´ ì¡´ì¬í•œë‹¤. 

| íƒ€ì…    | ì„¤ëª…                                                 |
| ------- | ---------------------------------------------------- |
| ID      | ê¸°ë³¸ì ìœ¼ë¡œëŠ” Stringì´ë‚˜, ê³ ìœ  ì‹ë³„ì ì—­í• ì„ì„ ë‚˜íƒ€ëƒ„ |
| String  | UTF-8 ë¬¸ìì—´                                         |
| Int     | ë¶€í˜¸ê°€ ìˆëŠ” 32ë¹„íŠ¸ ì •ìˆ˜                              |
| Float   | ë¶€í˜¸ê°€ ìˆëŠ” ë¶€ë™ì†Œìˆ˜ì  ê°’                            |
| Boolean | ì°¸/ê±°ì§“                                              |
| !       | nullì„ ë°˜í™˜í•  ìˆ˜ ì—†ë‹¤.                               |
| [Type]  | ë°°ì—´                                                 |

<br>

ì´ì™¸ì—ë„ enum, union, interface, input íƒ€ì…ì´ ì¡´ì¬í•œë‹¤. (ìì„¸í•œ ë‚´ìš©ì€ [ê³µì‹ë¬¸ì„œ](https://graphql-kr.github.io/learn/schema/) ì°¸ê³ )

<br>

## 2)  Query (Read)

ì¼ë°˜ì ìœ¼ë¡œ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë¥¼ ì°¾ìœ¼ë ¤ëŠ” ê²½ìš°ê°€ ë§ë‹¤. 

ê·¸ëŸ° ê²½ìš° **ì¸ìë¥¼ ì‚¬ìš©**í•˜ì—¬ ì¡°ê±´ì„ ì œí•œí•  ìˆ˜ ìˆë‹¤. 

```javascript
// typeDefs: idë¥¼ ì¸ìë¡œ ë°›ì•„ í•´ë‹¹ ê°’ì„ ê°€ì§€ê³  ìˆëŠ” teamì„ ë°˜í™˜í•œë‹¤. 
const typeDefs = gql`
  type Query {
  team(id: Int): Team
  }
`

// resolver 
const resolvers = {
  Query: {
    team: (parent, args, context, info) => database.teams
      .filter((team) => {
          return team.id === args.id
      })[0]
  }
}
```

<br>

ì—¬ëŸ¬ ê³„ì¸µì˜ ì •ë³´ë¥¼ ìš”ì²­í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì´ í•´ê²° í•  ìˆ˜ ìˆë‹¤.  **(UnderFetching ë¬¸ì œ í•´ê²° )**

ì˜ˆë¥¼ ë“¤ë©´, Teamê³¼ Supplyê°€ 1:N ê´€ê³„ì¼ ë•Œ Teamì˜ íƒ€ì…ì— suppliesë¼ëŠ” í•„ë“œë¥¼ ë§Œë“¤ì–´ Supplyì˜ ë°°ì—´ íƒ€ì…ì„ ì¶”ê°€í•œë‹¤.

ê·¸ í›„,  Teamì˜ ë°ì´í„°ë¥¼ ìš”ì²­ í• ë•Œ í•´ë‹¹ Teamì— ë§ëŠ” Supplyë¥¼ supplies í•„ë“œì— ì¶”ê°€í•˜ëŠ” ë¡œì§ì„ ë„£ì–´  Supply ë°ì´í„°ë¥¼ í•¨ê»˜ ë°˜í™˜í•œë‹¤.  

```javascript
// í•´ë‹¹ teamì´ ì†Œìœ í•˜ê³  ìˆëŠ” suppliesë¥¼ ê°™ì´ ìš”ì²­í•œë‹¤. 
const typeDefs = gql`
  type Query {
    teams: [Team] 
  }
  type Team {
    id: Int
    manager: String
    office: String
    extension_number: String
    mascot: String
    cleaning_duty: String
    project: String
    supplies: [Supply]
  }
  
  type Supply {
    id: string
    team: Int
  }
`

const resolvers = {
  Query: {
    teams: () => database.teams
      .map((team)=> {
        team.supplies = database.supplies
        .filter((supply) => {
          return supply.team === team.id
        })
        return team
      })
  }
}
```

<br>

## 3) Mutation (Create, Update, Delete)

```javascript
// í•´ë‹¹ íŒ€ì„ ì‚­ì œí•˜ê³  ì‚­ì œí•œ íŒ€ì„ ë°˜í™˜í•œë‹¤. 
const typeDefs = gql`
  type Mutation {
    deleteTeam(id:Int): Team
  }
`

const resolvers = {
   Mutatation: {
     deleteTeam: (parent, args, context, info) => {
         const deleted = database.teams
         .filter((team) => {
             return team.id === args.id
         })[0]
         database.team = database.teams
           .filter((team) => {
           return team.id !== args.id
            })
          return deleted
     }
   }
}
```

<br>

# 5. Request

[ê³µì‹ ë¬¸ì„œ](https://graphql.org/learn/queries/)

í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ë°©ì‹ì„ ì•Œì•„ë³´ë©´,  ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íŠ¹ì •í•œ í•„ë“œë¥¼ ìš”ì²­í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë˜ì–´ ìˆë‹¤. 

```javascript
// teamsë¼ëŠ” Actionì„ í†µí•´ Team ë°ì´í„°ë¥¼ ìš”ì²­í•œë‹¤. 
// Team ë°ì´í„°ì˜ id, manager, office í•„ë“œë§Œ ìš”ì²­í•˜ê³  ìˆë‹¤. 
query requestTeam {
    teams {
        id
        manager
        office
    }
}
```

<br>

```javascript
// ë°˜í™˜ ë˜ëŠ” ë°°ì—´ì„ ë³„ì¹­ myTeamìœ¼ë¡œ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤. 
query requestTeam {
    myTeam: team {
        id
        manager
        office
    }
}

// ì¡°ê±´ì„ ì§€ì •í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì†Œê´„í˜¸ë¥¼ ì´ìš©í•˜ì—¬ ì¸ìë¥¼ ì „ë‹¬í•œë‹¤. 
query requestTeam {
    team(id:1) {
        id
        manager
        office
    }
}


// ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ìì— ì „ë‹¬í•  ìˆ˜ë„ ìˆë‹¤. (ë™ì  ì¿¼ë¦¬)
// ì„ ì–¸ëœ ë³€ìˆ˜ëŠ” scalars, enums, or input object íƒ€ì… ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•œë‹¤. 
query requestTeam($id: Id) {
    team(id: $id) {
        id
        manager
        office
    }
}


// ë³€ìˆ˜ì— ê¸°ë³¸ ê°’ì„ ì§€ì •í•´ ì¤„ ìˆ˜ë„ ìˆë‹¤. 
// ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ìì— ì „ë‹¬í•  ìˆ˜ë„ ìˆë‹¤. 
query requestTeam($id: Id = ABC) {
    team(id: $id) {
        id
        manager
        office
    }
}


// ...ì„ ì´ìš©í•˜ì—¬ íƒ€ì…ì— ì œí•œì„ ì¤„ ìˆ˜ë„ ìˆë‹¤. 
// ë°˜í™˜ë˜ëŠ” ë°ì´í„°ì˜ managerê°€ Developer íƒ€ì…ì¸ì§€ Marketing íƒ€ì…ì¸ì§€ì— ë”°ë¼ ë°˜í™˜ë˜ëŠ” ë°ì´í„°ê°€ ë‹¤ë¥´ë‹¤. 
query requestTeam {
    teams {
        manager
		... on Developer {
           office
        }
        
        ... on Marketing {
          id
        }
    }
}
```

<br>

íƒ€ì…ì´ ë³µì¡í•œ ê²½ìš° Fragmentë¥¼ ì‚¬ìš©í•˜ì—¬ **ì¬ì‚¬ìš©** í•  ìˆ˜ ìˆë‹¤. 

```javascript
const TeamInfo = gql`
  fragment teamInfo on Team {
    manager
    year
  }
`

const WorkInfo = gql`
  fragment workInfo on Team {
    office
    role
  }
`

const Get_TEAM = gql`
 query GetTeam {
   team {
     id
     ...workInfo
     ...teamInfo
   }
   
   ${WorkInfo}
   ${TeamInfo}
 }
`
```

<br>

ë˜í•œ, ì§€ì‹œì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¢€ ë” í¸ë¦¬í•˜ê²Œ ë°ì´í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. 

```javascript
const Get_TEAM = gql`
 query GetTeam($id: Int!, $checkManager:Boolean = true) {
   team(id: $id) {
    id
    manager @include(if: $checkManager)
    office
   }
 }
`
```

- `@include(if: Boolean)`: ì¸ìê°€ `true` ì¸ ê²½ìš°ì—ë§Œ ì´ í•„ë“œë¥¼ ê²°ê³¼ì— í¬í•¨í•œë‹¤.
- `@skip(if: Boolean)` ì¸ìê°€ `true` ì´ë©´ ì´ í•„ë“œë¥¼ ê±´ë„ˆë›´ë‹¤.

<br>
