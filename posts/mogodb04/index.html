<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="MongoDB-index를-활용하여-빠른-탐색하기" /><meta name="author" content="박재경" /><meta property="og:locale" content="ko" /><meta name="description" content="1. Index" /><meta property="og:description" content="1. Index" /><link rel="canonical" href="https://jaekp.github.io/posts/mogodb04/" /><meta property="og:url" content="https://jaekp.github.io/posts/mogodb04/" /><meta property="og:site_name" content="Hello, World!" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-10T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="MongoDB-index를-활용하여-빠른-탐색하기" /><meta name="google-site-verification" content="LP7vGYSUszERSVMH1MoT4NXRTCcbUaUtfFm_pOYcoQ4" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"박재경"},"dateModified":"2023-02-10T00:00:00+09:00","datePublished":"2023-02-10T00:00:00+09:00","description":"1. Index","headline":"MongoDB-index를-활용하여-빠른-탐색하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://jaekp.github.io/posts/mogodb04/"},"url":"https://jaekp.github.io/posts/mogodb04/"}</script><title>MongoDB-index를-활용하여-빠른-탐색하기 | Hello, World!</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hello, World!"><meta name="application-name" content="Hello, World!"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/mococo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hello, World!</a></div><div class="site-subtitle font-italic">난 재경쓰!</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/JaeKP" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jkp71192','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>MongoDB-index를-활용하여-빠른-탐색하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>MongoDB-index를-활용하여-빠른-탐색하기</h1><div class="post-meta text-muted"><div> By <em> 박재경 </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1675954800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-02-10 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2316 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><h1 id="1-index">1. Index</h1><blockquote class="prompt-tip"><div><p>인덱스는 문서의 필드 값을 색인하여 콜렉션에서 데이터를 빠르게 탐색할 수 있도록 도와 빠른 쿼리 작업을 지원하고 데이터 정렬 및 집계 작업이 효율적으로 실행될 수 있도록 한다.</p></div></blockquote><h2 id="1-정의"><span class="mr-2">1) 정의</span><a href="#1-정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>우리가 사전에서 단어를 빨리 찾을 수 있는 이유는 색인에 따른 정렬이 되어있기 때문이다. 데이터도 탐색을 효율적으로 하기위해 Index를 사용하여 효과적으로 데이터를 탐색할 수 있다.</p><p>MongoDB에서 Index는 B-tree와 같은 데이터 구조를 유지하여 <strong>필드의 값을 문서의 위치로 매핑</strong>한다. (키랑 주소만 저장하여 데이터를 매핑)</p><p>그래서 쿼리가 실행될 때, MongoDB는 전체 콜렉션을 검색할 필요 없이 인덱스를 사용하여 관련 문서를 찾을 수 있게 된다.</p><p>예를 들어, 사용자를 나타내는 문서의 콜렉션이 있고 각 문서에 <code class="language-plaintext highlighter-rouge">age</code>라는 필드가 있는 데이터 베이스가 있다. <code class="language-plaintext highlighter-rouge">age</code> 필드에 인덱스를 생성하게 되면 MongoDB는 <strong>모든 문서를 검사할 필요 없이</strong> 특정 나이를 가진 모든 문서를 효율적으로 찾을 수 있게 된다.</p><p><br /></p><p>인덱스가 없다면, age가 30인 유저를 백만개의 데이터 중에서 찾을때 모든 콜렉션을 탐색한다.</p><p>그래서 총 125ms가 소요되는 것을 아래의 이미지에서 확인할 수 있다.</p><p><img data-src="https://raw.githubusercontent.com/JaeKP/image_repo/main/img/image-20230209171416347.png" alt="image-20230209171416347" data-proofer-ignore></p><p><br /></p><p>Index를 사용하면 총 10ms로 압도적으로 시간이 줄어드는 것을 확인할 수 있다. 인덱스를 사용하면, 모든 콜렉션을 탐색하는 것이 아니라 인덱스 정보를 <code class="language-plaintext highlighter-rouge">Fetch</code>하고 <code class="language-plaintext highlighter-rouge">IXSCAN</code>(인덱스 스캔)을 통해 데이터를 찾는 것을 확인할 수 있다.</p><p><img data-src="https://raw.githubusercontent.com/JaeKP/image_repo/main/img/image-20230209171738891.png" alt="image-20230209171738891" data-proofer-ignore></p><p><br /></p><p>그러나 인덱스는 <strong>추가 디스크 공간을 사용</strong>하고, 각 문서에 기록할 때마다 관련 인덱스를 업데이트 해야하므로 <strong>쓰기 작업이 느려질 수 있다.</strong></p><ul><li><p>데이터를 생성할 때, Index도 생성하고 저장해야 하기 때문에 쓰기 작업이 느려진다.</p><li>MongoDB는 모든 콜렉션에 대해 <code class="language-plaintext highlighter-rouge">_id</code> 필드에 대한 인덱스를 자동으로 생성하여 각 문서에 고유 식별자가 있어 효율적으로 위치를 지정할 수 있다.<li><code class="language-plaintext highlighter-rouge">unique</code>한 값에도 자동으로 index가 생성된다. 왜냐하면 중복인지 아닌지 확인하기 위해서는 탐색을 해야하기 때문에 index가 필요한 것이다.</ul><p><br /></p><h2 id="2-index-selectivity"><span class="mr-2">2) Index Selectivity</span><a href="#2-index-selectivity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote class="prompt-tip"><div><p>MongoDB의 Index Selectivity는 특정 인덱스가 얼마나 정확하게 데이터를 검색하는지를 나타내는 지표다.</p><p>Selectivity는 0에서 1 사이의 값으로 표시되며, 1에 가까울수록 인덱스의 검색 정확도가 높다.</p></div></blockquote><p>인덱스의 Selectivity는 인덱스를 사용하여 검색할 때 검색하는 <strong>값의 유일성에</strong> 따라 결정된다.</p><p>예를 들어, 유일한 값이 있는 특정 필드에 대해서는 Selectivity가 1이 되어 검색 정확도가 높지만, 많은 값이 중복되는 필드에 대해서는 Selectivity가 낮아져 검색 정확도가 떨어질 수 있다.</p><p>MongoDB는 검색 성능을 향상시키기 위해 <strong>Selectivity가 높은 인덱스를 우선적으로 사용하도록 최적화</strong>되어 있어, Selectivity가 높은 인덱스를 사용하여 검색 쿼리를 작성하면 검색 성능이 향상될 수 있다.</p><p><br /></p><p>예를 들어, <code class="language-plaintext highlighter-rouge">name.last</code>에 대한 인덱스와 <code class="language-plaintext highlighter-rouge">age</code>에 대한 인덱스가 있는 데이터 베이스가 있다. 이 데이터 베이스에서<code class="language-plaintext highlighter-rouge">{"name.last": "Hoeger", age: 24}</code> 와 조건이 일치한 결과를 탐색한다면 어떤 인덱스를 활용할까?</p><p>이는 앞서 말했 듯, Selectivity가 높은 <code class="language-plaintext highlighter-rouge">name.last</code> 인덱스를 사용한다. (다양성이 더 많음)</p><p><img data-src="https://raw.githubusercontent.com/JaeKP/image_repo/main/img/image-20230210163636359.png" alt="image-20230210163636359" data-proofer-ignore></p><p><br /></p><h2 id="3-구현"><span class="mr-2">3) 구현</span><a href="#3-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>MongoDB Compass에서 간단하게 Index를 생성 할 수도 있고, 코드로 생성할 수도 있다.</p><ol><li>Schema를 정의할 때, index 속성 사용<li>Schema의 Index 메서드 사용</ol><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Schema</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">Types</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CommentSchema</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Comment.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">BlogSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="na">content</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>

    <span class="na">isLive</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// 1. index 속성으로 인덱스 생성</span>
      <span class="na">_id</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">ref</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="na">username</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="na">name</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">first</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
        <span class="na">last</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span>

    <span class="na">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommentSchema</span><span class="p">],</span>
  <span class="p">},</span>
  <span class="p">{</span> <span class="na">timestamps</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">);</span>


<span class="c1">// 2. index 메서드로 인덱스 생성 </span>
<span class="c1">// unique: true 속성을 줄 수도 있다.  </span>
<span class="nx">BlogSchema</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span> <span class="na">updateAt</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>
<span class="nx">BlogSchema</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span> <span class="na">updateAt</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="na">unique</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="nx">model</span><span class="p">(</span><span class="dl">"</span><span class="s2">blog</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BlogSchema</span><span class="p">);</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Blog</span><span class="p">;</span>

</pre></table></code></div></div><p><br /></p><h1 id="2-compoundkey">2. CompoundKey</h1><blockquote class="prompt-tip"><div><p>CompoundKey(복합키)란 다수의 필드를 포함하는 고유한 키로 한 개의 도큐먼트에서 각 필드 값의 조합이 고유하게 식별되어야 하는 경우 사용된다.</p></div></blockquote><h2 id="1-정의-1"><span class="mr-2">1) 정의</span><a href="#1-정의-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>MongoDB에서는 도큐먼트의 <strong>각 필드 값을 결합</strong>하여 고유한 식별자를 생성할 수 있다.</p><p>예를 들어, 고객 정보를 저장할 때 고객의 이름과 주소를 결합한 값을 고유 식별자로 사용할 수있고 이를 CompoundKey라고 한다.</p><p>해당 키를 사용하여 고객의 이름과 주소를 기준으로 검색, 정렬한 데이터를 더 빠르게 얻을 수 있다.</p><ul><li>CompundKey의 원리는 각 필드 값을 결합하여 고유한 키를 생성한다.<li>MongoDB는 <strong>BSON(Binary JSON)</strong> 형식으로 저장되는 도큐먼트를 사용하기 때문에 각 필드 값을 결합하여 고유한 식별자를 생성할 수 있다.<ul><li>BSON은 MongoDB에서 사용하는 데이터 형식으로 JSON 형식의 데이터를 이진 형식으로 저장한다.<li>BSON은 더 빠르고 효율적으로 데이터를 저장, 전송할 수 있다.</ul></ul><p><br /></p><p>CompoundKey를 다음과 같이 활용할 수 있다.</p><ul><li>중복 데이터 방지: CompoundKey를 사용하면, 각 도큐먼트가 고유하게 식별되어 중복 데이터를 방지할 수 있다.<li>검색 성능 향상: CompoundKey 기반으로 검색할 수 있어 빠른 속도로 데이터를 조회할 수 있다.<li>데이터 구조 정의: CompoundKey를 통해 필드 값을 결합하여 원하는 키 구조를 생성할 수 있어 데이터 구조를 정의할 수 있다.</ul><p><strong>CompoundKey는 고유성, 성능, 유연성을 향상시킬 수 있는 기능으로 적절히 활용하면 더 효율적인 데이터 관리와 분석이 가능하다.</strong></p><p><br /></p><h2 id="2-구현"><span class="mr-2">2) 구현</span><a href="#2-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Schema</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">Types</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CommentSchema</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Comment.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">BlogSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="na">content</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="na">isLive</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">_id</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">ref</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span> <span class="p">},</span>

      <span class="na">username</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="na">name</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">first</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
        <span class="na">last</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span>

    <span class="na">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommentSchema</span><span class="p">],</span>
  <span class="p">},</span>
  <span class="p">{</span> <span class="na">timestamps</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// CompoundKey index 생성 </span>
<span class="nx">BlogSchema</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span> <span class="dl">"</span><span class="s2">user._id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">updateAt</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="nx">model</span><span class="p">(</span><span class="dl">"</span><span class="s2">blog</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BlogSchema</span><span class="p">);</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Blog</span><span class="p">;</span>

</pre></table></code></div></div><p><br /></p><h1 id="3-textindex">3. textIndex</h1><blockquote class="prompt-tip"><div><p>MongoDB에서 텍스트 검색을 위한 인덱스이다.</p></div></blockquote><h2 id="1-정의-2"><span class="mr-2">1) 정의</span><a href="#1-정의-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>일반적인 B-Tree 인덱스는 숫자나 날짜와 같은 정수, 부동소수점 타입의 값을 인덱스하지만 textIndex는 텍스트 필드의 값을 인덱스하여 텍스트 검색 쿼리를 할 수 있다. 검색할 텍스트 필드의 모든 단어를 색인하고 단어의 빈도수와 위치 등의 정보를 포함하여 검색 결과의 정확도를 향상시킨다.</p><p>예를 들어, title에 특정 단어가 들어간 블로그 게시글을 찾으려고 한다면 textIndex를 title필드에 생성하여 아래의 이미지와 같이 데이터를 탐색할 수 있다.</p><p><img data-src="https://raw.githubusercontent.com/JaeKP/image_repo/main/img/image-20230210165334824.png" alt="image-20230210165334824" data-proofer-ignore></p><p><br /></p><h2 id="2-구현-1"><span class="mr-2">2) 구현</span><a href="#2-구현-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Schema</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">Types</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CommentSchema</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Comment.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">BlogSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">(</span>
  <span class="p">{</span>
    <span class="na">title</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="na">isLive</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="na">_id</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">ref</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span> <span class="p">},</span>
      <span class="na">username</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="na">name</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">first</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
        <span class="na">last</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span>

    <span class="nx">comments</span><span class="p">:</span> <span class="p">[</span><span class="nx">CommentSchema</span><span class="p">],</span>
  <span class="p">},</span>
  <span class="p">{</span> <span class="na">timestamps</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nx">BlogSchema</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span> <span class="dl">"</span><span class="s2">user._id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">updateAt</span><span class="p">:</span> <span class="mi">1</span> <span class="p">});</span>

<span class="c1">// text Index는 콜렉션에서 한개만 만들 수 있다.</span>
<span class="nx">BlogSchema</span><span class="p">.</span><span class="nx">index</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">Blog</span> <span class="o">=</span> <span class="nx">model</span><span class="p">(</span><span class="dl">"</span><span class="s2">blog</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BlogSchema</span><span class="p">);</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Blog</span><span class="p">;</span>

</pre></table></code></div></div><ul><li>textIndex는 콜렉션에서 한 개만 만들 수 있기 때문에, 만약 content에 대한 textIndex도 추가하고 싶으면 복합 키를 만들면 된다.<ul><li><code class="language-plaintext highlighter-rouge">BlogSchema.index({title: "text", content: "text"})</code></ul></ul><p><br /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>WEB</a>, <a href='/categories/mongodb/'>MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >MongoDB</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MongoDB-index%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EB%B9%A0%EB%A5%B8-%ED%83%90%EC%83%89%ED%95%98%EA%B8%B0+-+Hello%2C+World%21&url=https%3A%2F%2Fjaekp.github.io%2Fposts%2Fmogodb04%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MongoDB-index%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EB%B9%A0%EB%A5%B8-%ED%83%90%EC%83%89%ED%95%98%EA%B8%B0+-+Hello%2C+World%21&u=https%3A%2F%2Fjaekp.github.io%2Fposts%2Fmogodb04%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjaekp.github.io%2Fposts%2Fmogodb04%2F&text=MongoDB-index%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EB%B9%A0%EB%A5%B8-%ED%83%90%EC%83%89%ED%95%98%EA%B8%B0+-+Hello%2C+World%21" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/mogodb01/">MongoDB-환경설정과-간단한-CRUD구현하기</a><li><a href="/posts/performance03/">실전-웹-성능-최적화-(feat. React)-Part2</a><li><a href="/posts/performance01/">실전-웹-성능-최적화-(feat. React)-Part1</a><li><a href="/posts/nft03/">03-Solidity-문법-기초</a><li><a href="/posts/nft04/">03-DApp-web3를-이용하여-이더리움과-상호작용하기</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/til/">til</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/vue/">vue</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/moviewiki/">MovieWiki</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mogodb01/"><div class="card-body"> <em class="timeago small" data-ts="1675350000" > 2023-02-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MongoDB-환경설정과-간단한-CRUD구현하기</h3><div class="text-muted small"><p> 강의 링크 MongoDB는 NoSQL 데이터 베이스 중 하나이다. NoSQL은 Not Only SQL의 줄임말로 기존의 RDBMS의 한계를 극복하기 위해 만들어진 새로운 형태의 데이터 저장소이다. 관계형 DB는 표를 저장한다면 MongoDB는 객체를 저장한다고 생각하면 된다. 즉, 관계형 DB가 아니므로, RDMS처럼 고정된 스키마 ...</p></div></div></a></div><div class="card"> <a href="/posts/mogodb02/"><div class="card-body"> <em class="timeago small" data-ts="1675350000" > 2023-02-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MongoDB-관계된-데이터-관리</h3><div class="text-muted small"><p> 강의 링크 1. 1:N 관계 1:N 관계는 한 쪽 엔티티가 관계를 맺은 엔티티 쪽의 여러 객체를 가질 수 있는 것을 의미한다. 실제 DB를 설계할 때 자주 쓰이는 방식이다. 1) Schema 작성 일반적인 게시판을 생각하면, 하나의 유저가 여러 개의 게시글을 작성한다. 콜렉션 관계 ...</p></div></div></a></div><div class="card"> <a href="/posts/mogodb03/"><div class="card-body"> <em class="timeago small" data-ts="1675609200" > 2023-02-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MongoDB-Read-성능-향상시키기</h3><div class="text-muted small"><p> 강의 링크 Read는 퍼포먼스에 많은 영향을 미친다. 서로 연결되어 있는 데이터를 가공, 조합해야 하기 때문에 DB 설계를 어떻게 하느냐 따라 성능이 달라진다. 만약 다음과 같은 콜렉션을 가진 데이터베이스가 있다고 가정해보자. 콜렉션 관계 User 1 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/mogodb03/" class="btn btn-outline-primary" prompt="Older"><p>MongoDB-Read-성능-향상시키기</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/JaeKP">박재경</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/til/">til</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/vue/">vue</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/moviewiki/">MovieWiki</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
