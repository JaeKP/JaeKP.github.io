<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="운영체제-Process-Synchronization" /><meta name="author" content="박재경" /><meta property="og:locale" content="ko" /><meta name="description" content="6장-Process-Synchronization" /><meta property="og:description" content="6장-Process-Synchronization" /><link rel="canonical" href="https://jaekp.github.io/posts/operationsystem06/" /><meta property="og:url" content="https://jaekp.github.io/posts/operationsystem06/" /><meta property="og:site_name" content="Hello, World!" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-20T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="운영체제-Process-Synchronization" /><meta name="google-site-verification" content="LP7vGYSUszERSVMH1MoT4NXRTCcbUaUtfFm_pOYcoQ4" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"박재경"},"dateModified":"2022-09-20T00:00:00+09:00","datePublished":"2022-09-20T00:00:00+09:00","description":"6장-Process-Synchronization","headline":"운영체제-Process-Synchronization","mainEntityOfPage":{"@type":"WebPage","@id":"https://jaekp.github.io/posts/operationsystem06/"},"url":"https://jaekp.github.io/posts/operationsystem06/"}</script><title>운영체제-Process-Synchronization | Hello, World!</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hello, World!"><meta name="application-name" content="Hello, World!"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/mococo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hello, World!</a></div><div class="site-subtitle font-italic">난 재경쓰!</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/JaeKP" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jkp71192','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>운영체제-Process-Synchronization</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>운영체제-Process-Synchronization</h1><div class="post-meta text-muted"><div> By <em> 박재경 </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1663599600" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-20 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3329 words"> <em>18 min</em> read</span></div></div></div><div class="post-content"><h1 id="6장-process-synchronization">6장-Process-Synchronization</h1><p><a href="http://www.kocw.net/home/search/kemView.do?kemId=1046323">강의 링크</a></p><blockquote class="prompt-tip"><div><p>공유데이터의 동시 접근은 데이터의 불일치 문제를 발생시킨다.</p><p>일관성 유지를 위해서는 협력 프로세스 간의 실행 순서를 정리해주는 메커니즘이 필요하다.</p></div></blockquote><p><br /></p><h2 id="1-기본-개념"><span class="mr-2">1. 기본 개념</span><a href="#1-기본-개념" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="1--race-condition"><span class="mr-2">1) Race Condition</span><a href="#1--race-condition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>Race Condition(경쟁 상태)는 여러 프로세스들이 동시에 데이터를 접근하는 상황에서 어떤 순서로 접근하느냐에 따라 결과가 달라지는 상황을 의미한다.</p></blockquote><p>여러 프로세스들이 동시에 공유 데이터를 접근하는 상황으로 데이터의 최종 연산 결과는 마지막에 그 데이터를 다룬 프로세스에 따라 달라진다.</p><ul><li>Kernel 수행 중 인터럽트 발생<ul><li>커널모드 running 중 인터럽트가 발생하여 인터럽트 처리 루틴이 수행되면 양쪽 다 커널 코드이므로 kernel address space를 공유한다.<li>해결책: 커널모드의 수행이 끝나기 전에는 인터럽트를 받지 않는다. (disable/enable)</ul><li>Process가 System call을 해서 kernel mode로 수행 중인데 context swtich가 일어난 경우<ul><li>두 프로세스의 주소 공간에서ㄷ는 데이터를 공유하지 않지만 시스템 콜을 수행할 때는 둘 다 커널 주소 공간의 데이터에 접근한다.<li>커널 주소 공간에 작업을 수행하는 도중에 CPU를 빼앗으면 race condition이 발생한다.<li>해결책: 커널 모드를 수행 중일 땐 CPU가 preempt 하지 않고, 커널 모드에서 유저 모드로 돌아갈 때 preempt 한다.</ul><li>Multiprocessor에서 shared-memory 내의 kernel data<ul><li>해결책: 커널 내부에 있는 공유 데이터에 접근할 때마다 그 데이터에 대해서 lock/unlock 한다.</ul></ul><p><strong>race condition을 막기 위해서는 concurrent process는 동기화 되어야 한다.</strong></p><p><br /></p><h3 id="2-critical-section"><span class="mr-2">2) Critical-Section</span><a href="#2-critical-section" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote class="prompt-tip"><div><p>n개의 프로세스가 공유 데이터를 동시에 사용하기를 원하는 경우로 race condition이 발생할 수 있는 특정 부분을 의미한다.</p></div></blockquote><ul><li>각 프로세스의 code segment에는 공유 데이터를 접근하는 코드인 critical section이 존재한다.<li>해결 법의 충족 조건<ul><li>Mutual Exclusion (상호 배제): 프로세스가 critical section 부분을 수행 중이면 다른 프로세스들은 그들의 critical section에 들어가면 안된다.<li>Progress (진행): 아무도 critical section에 있지 않은 상태에서 critical section에 들어가고자 하는 포르세스가 있으면 critical section에 들어가게 해주어야 한다.<li>Bounded Waiting (유한 대기): 프로세스가 critical section에 들어가려고 요청한 후부터 그 요청이 허용될 떄까지 다른 프로세스들이 critical section에 들어가는 횟수에 한계가 있어야 한다.</ul><li>하드웨어적으로 현재 상태를 확인하고 변경하는 Test &amp; modify를 atomic하게 수행할 수 있도록 지원하면 간단하게 해결할 수 있다.<li>소프트웨어적으로 알고리즘을 통해 해결할 수 있지만, 하드웨어적으로 해결하는 것이 더 간편하다.<li>데이터를 읽으면서 동시에 쓰는 것이 하나의 instruction으로 수행이 가능하다면, 수행 중 CPU를 빼앗기지 않는다.<li>Test_and_set(a): a의 값을 읽고 a의 값을 1로 세팅한다. =&gt; 하나의 instruction이다.<ul><li>lock이 안 걸렸다면, 걸고 들어간다.<li>lock이 걸려있으면, while 문을 돌면서 기다린다.</ul></ul><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Synchronization variable: </span>
<span class="n">boolean</span> <span class="n">lock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="c1">// Process Pi</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="n">Test_and_Set</span><span class="p">(</span><span class="n">lock</span><span class="p">));</span>
    <span class="n">critical</span> <span class="n">section</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">remainder</span> <span class="n">section</span>
<span class="p">}</span>
</pre></table></code></div></div><p><br /></p><h2 id="2-semaphores"><span class="mr-2">2. Semaphores</span><a href="#2-semaphores" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote class="prompt-tip"><div><p>앞서 말한 방법을 추사화한 것으로, 공유된 자원의 데이터를 여러 프로세스가 접근하는 것을 막는다.</p><p>소프트웨어상에서 Critical Section 문제를 해결하기 위한 동기화 도구로 공유 자원을 획득하고 반납하는 것을 처리한다.</p><p>주로 S라는 정수형 변수로 나타내며, 이는 사용 가능한 자원의 개수를 의미한다.</p></div></blockquote><ul><li>Counting Semaphore<ul><li>자원의 개수가 여러 개 있다. (여분의 자원을 사용 가능)<li>도메인이 0 이상인 임의의 정수 값<li>주로 resource counting에 사용한다.</ul><li>Binary Semaphore<ul><li>변수가 0 혹은 1인 경우이다. (자원의 개수가 1개인 경우)<li>0 또는 1 값만 가질 수 있는 Semaphore<li>주로 mutual exclusion에 사용한다.</ul></ul><p><br /></p><p>세마포어 변수는 오직 두 개의 atomic 한 연산을 통해서 접근할 수 있다. P연산 V연산으로 동기화를 한다.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">procedure</span> <span class="n">P</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="k">while</span> <span class="n">S</span><span class="o">=</span><span class="mi">0</span> <span class="k">do</span> <span class="n">wait</span> <span class="c1">// S가 0이면 대기</span>
<span class="n">S</span> <span class="o">:=</span> <span class="n">S</span><span class="o">-</span><span class="mi">1</span>          <span class="c1">// S가 1이면 0으로 만들고 진입</span>
<span class="n">end</span> <span class="n">P</span>
</pre></table></code></div></div><ul><li>p 연산: 공유 데이터를 획득 하는 과정<ul><li>같이 들어갈 수 없는 임계영역에 들어가고자 하는 프로세스는 P를 거쳐야 한다.<li>하나의 프로세스만 P연산 (나머지는 대기)</ul></ul><p><br /></p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">procedure</span> <span class="n">V</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>          <span class="c1">// 현재상태는 S가 0</span>
<span class="n">S</span> <span class="o">:=</span> <span class="n">S</span><span class="o">+</span><span class="mi">1</span>                <span class="c1">// S를 1로 해제</span>
<span class="n">end</span> <span class="n">V</span>                   <span class="c1">// 이제는 다른 프로세스가 들어 올수 있음</span>
</pre></table></code></div></div><ul><li>v 연산: 공유 데이터를 반납하는 과정<ul><li>P연산을 통과해 임계영역의 연산을 끝낸 프로세스가 V연산을 수행하게 된다.</ul></ul><p><br /></p><h3 id="1--busy-wait"><span class="mr-2">1) Busy-wait</span><a href="#1--busy-wait" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Synchronization variable: </span>
<span class="n">sempaphore</span> <span class="n">mutex</span><span class="p">;</span> 

<span class="n">ProcessPi</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="n">P</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>  <span class="c1">// if positive, dec-&amp;-enter, Othrewise, wait</span>
    <span class="n">critical</span> <span class="n">section</span>
    <span class="n">V</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>  <span class="c1">// Increment semaphore</span>
    <span class="n">remainder</span> <span class="n">section</span>
<span class="p">}</span><span class="n">white</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>Busy Waiting이 발생한다.<ul><li>Busy Waiting: Critical Section 에 진입해야하는 프로세스가 진입 코드를 계속 반복 실행해야 하여 CPU 시간을 낭비하는 것.</ul><li>그래서 Block &amp; Wake up 방식을 사용한다.</ul><p><br /></p><h3 id="2--block--wake-up"><span class="mr-2">2) Block &amp; Wake up</span><a href="#2--block--wake-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote class="prompt-tip"><div><p>Critical Section으로의 진입에 실패한 프로세스를 기다리게 하지 않고 Block 시킨다. Critical Section에 자리가 나면 다시 깨워줌으로써 Busy waiting에서의 CPU 낭비 문제를 해결한다.</p></div></blockquote><p>semaphore를 획득 하지 못하면 block 되고 PCB를 큐에 넣고 semaphore를 기다린다.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>          <span class="c1">// semaphore</span>
    <span class="k">struct</span> <span class="n">process</span> <span class="o">*</span><span class="n">L</span><span class="p">;</span>  <span class="c1">// process wait queue</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th>단어<th>설명<tbody><tr><td>block<td>커널은 block을 호출한 프로세스를 suspend 시킨다. <br />이 프로세스의 PCB를 semaphore에 대한 wait queue에 넣는다.<tr><td>wakeup<td>block된 프로세스 P를 wakeup시킨다.<br />이 프로세스의 PCB를 ready queue로 옮긴다.</table></div><p><br /></p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">// P(S)</span>
<span class="n">S</span><span class="p">.</span><span class="n">value</span><span class="o">++</span><span class="p">;</span> <span class="c1">// prepare to enter</span>
<span class="k">if</span> <span class="p">(</span><span class="n">S</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// Oops, negative, I cannot enter</span>
<span class="p">{</span>
    <span class="n">add</span> <span class="n">this</span> <span class="n">process</span> <span class="n">to</span> <span class="n">S</span><span class="p">.</span><span class="n">L</span><span class="p">;</span>
    <span class="n">block</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// V(S)</span>
<span class="n">S</span><span class="p">.</span><span class="n">value</span><span class="o">++</span><span class="p">;</span> 
<span class="k">if</span> <span class="p">(</span><span class="n">S</span><span class="p">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">remove</span> <span class="n">a</span> <span class="n">prosess</span> <span class="n">P</span> <span class="n">from</span> <span class="n">S</span><span class="p">.</span><span class="n">L</span><span class="p">;</span>
    <span class="n">wakeup</span><span class="p">(</span><span class="n">P</span><span class="p">);</span>
<span class="p">}</span> 
</pre></table></code></div></div><p><br /></p><h3 id="3-busy-wait-vs-blockwakeup"><span class="mr-2">3) Busy-wait vs Block/Wakeup</span><a href="#3-busy-wait-vs-blockwakeup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Critial Section의 길이가 긴 경우 Block/Wakeup이 적당하다.<li>Critial Section의 길이가 매우 짧은 경우 Block/Wakeup 오버 헤드가Busy-Wait 오버헤드보다 더 커질 수 있다.<li>일반적으로는 Block/Wakeup방식이 더 좋다.</ul><p><br /></p><h3 id="4-문제점"><span class="mr-2">4) 문제점</span><a href="#4-문제점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Deadlock<ul><li>둘 이상의 프로세스가 서로 상대방에 의해 충족될 수 있는 event를 무한히 기다리는 현상<li>세마포어가 Ready Queue 를 가지고 있고, 둘 이상의 프로세스가 Critical Section 진입을 무한정 기다리고 있어서 Critical Section에서 실행되는 프로세스는 진입 대기 중인 프로세스가 실행되야만 빠져나올 수 있는 상황을 지칭한다.</ul><li>Starvation<ul><li>프로세스가 suspend된 이유에 해당하는 세마포어 큐에서 빠져나갈 수 없는 현상 (Indefinite blocking)</ul></ul><p><br /></p><h2 id="3-고전적인-문제들"><span class="mr-2">3. 고전적인 문제들</span><a href="#3-고전적인-문제들" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>공유데이터에서 싱크로나이즈와 관련하여 발생할 수 있는 여러 문제가 있다.</p><p><br /></p><h3 id="1-bounded-buffer-problem"><span class="mr-2">1) Bounded-Buffer Problem</span><a href="#1-bounded-buffer-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Producer (데이터): 데이터를 만들어서 넣는 주체</p><p>Consumer (데이터): 데이터를 꺼내서 소비하는 주체</p><ul><li>공유 버퍼 문제<ul><li>생산자 여러 명이 한 공간에 접근하여 데이터를 저장하려고 하면 문제가 발생한다.<li>소비자 여러 명이 한 공간에 접근하여 데이터를 꺼내가려고 하면 문제가 발생한다.</ul><li>버퍼가 유한성 (Bounded-Buffer)<ul><li>생산자가 빈 버퍼가 있으면 데이터를 넣을 수 있는데, 빈 버퍼의 수가 없으면 기다려야 한다. =&gt; 자원의 여분이 생길 때 까지!<li>소비자 입장에서도 자원의 여분이 없으면 내용이 들어있는 버퍼가 있을 때까지 기다려야 한다.</ul></ul><p><strong>그래서 세마포어는 두 가지 역힐을 해야 한다. <code class="language-plaintext highlighter-rouge">동시 접근을 막기 위해 lock을 거는 것</code>, <code class="language-plaintext highlighter-rouge">가용자원의 개수를 세는 카운팅</code></strong></p><p><br /></p><div class="table-wrapper"><table><thead><tr><th>Producer<th>Consumer<tbody><tr><td>1. Empty 버퍼가 있는지 체크<td>1. Full 버퍼가 있는제 체크<tr><td>2. 공유데이터에 lock을 건다<td>2. 공유 데이터에 lock을 건다<tr><td>3. Empty 버퍼에 데이터 입력 및 버퍼 조작<td>3. Full 버퍼에서 데이터를 꺼내고 버퍼를 조작한다.<tr><td>4. lock을 푼다<td>4. lock을 푼다<tr><td>5. Full buffer가 하나 증가한다.<td>5. Empty butter가 하나 증가한다.</table></div><p><br /></p><h3 id="2-readers-writers-problem"><span class="mr-2">2) Readers-Writers Problem</span><a href="#2-readers-writers-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Reader: DB를 읽는 주체</p><p>Writer: DB에 데이터를 넣는 주체</p><ul><li>한 process가 DB(공유데이터)에 write 중일 떄 다른 process가 접근하면 안된다. 그러나 Read는 동시에 여럿이 해도 된다.<ul><li>Writer가 DB에 접근 허가를 아직 얻지 못한 상태에서는 모든 대기 중인 Reader들을 다 DB에 접근하게 해준다.<li>Writer는 대기 중인 Reader가 하나도 없을 때 DB 접근이 허용된다.<li>일단 Writer가 DB에 접근 중이면 Reader들은 접근이 금지된다.<li>Writer가 DB에 빠져나가야만 Reader의 접근이 허용된다.</ul></ul><p>DB에 lock을 거는 용도로 <code class="language-plaintext highlighter-rouge">db</code>라는 바이너리 세마포어를 사용하여 Reader와 Writer가 공유 DB 자체를 올바르게 접근하도록 한다.</p><p>또한, <code class="language-plaintext highlighter-rouge">readcount</code>(현재 DB에 접근 중이 Reader의 수)에 lock을 거는 용도로<code class="language-plaintext highlighter-rouge">mutex</code>라는 바이너리 세마포어를 사용한다.</p><p>(Writer가 지나치게 기다리는 Starvation 문제가 발생할 수 있다. )</p><p><br /></p><h3 id="3-dining-philosophers-problem"><span class="mr-2">3) Dining-Philosophers Problem</span><a href="#3-dining-philosophers-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>철학자 5명이 원탁에서 식사를 하고 있다. 철학자의 업무는 다음과 같다.</p><ol><li>생각을 한다.<li>밥을 먹는다.</ol><p>그런데, 철학자마다 생각을 하거나 밥을 먹는 주기가 다르다. 밥을 먹을 때 어느 쪽 젓가락(공유 자원)을 잡아야 하는가.</p><p><br /></p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// 세마 포어 활용</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="n">P</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">P</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">]);</span>
    <span class="p">...</span>
    <span class="n">eat</span><span class="p">();</span>
    <span class="p">...</span>
    <span class="n">V</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">V</span><span class="p">(</span><span class="n">chopstick</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span><span class="p">]);</span>
    <span class="p">...</span>
    <span class="n">think</span><span class="p">()</span>
    <span class="p">...</span>
<span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></table></code></div></div><p>그러나 위의 방법은 Deadlock의 가능성이 있다.</p><ul><li>철학자가 모두 한번에 왼쪽 젓가락만 잡으면 오른쪽 젓가락을 잡지 않는다.</ul><p><br /></p><p><code class="language-plaintext highlighter-rouge">해결방안</code></p><ul><li>4명의 철학자만이 테이블에 동시에 앉을 수 있도록 한다.<li>젓거락을 두 개 모두 집을 수 있을 때에만 젓가락을 집을 수 있게 한다.<li>비대칭 (짝수 철학자는 왼쪽 젓가락만 집도록, 홀수 철학자는 오른쪽 젓가락만 집도록..)</ul><p><br /></p><h2 id="4-monitor"><span class="mr-2">4. Monitor</span><a href="#4-monitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote class="prompt-tip"><div><p>프로그래밍 언어 차원에서 싱크로나이즈를 해결하는 방법으로,</p><p>동시 수행 중인 프로세스 사이에서 abstract data type의 안전한 공유를 보장한다.</p></div></blockquote><p><br /></p><h3 id="1-세마포어의-문제점"><span class="mr-2">1) 세마포어의 문제점</span><a href="#1-세마포어의-문제점" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>코딩하기 어렵다<li>정확성의 입증이 어렵다.<li>자발적인 협력이 필요하다.<li>한번의 실수가 모든 시스템에 치명적 영향을 미친다.</ul><p><br /></p><h3 id="2-특징"><span class="mr-2">2) 특징</span><a href="#2-특징" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>모니터 내에서 한 번에 하나의 프로세스만이 활동이 가능하다.<ul><li>프로그래머가 동기화 제약 조건을 명시적으로 코딩할 필요가 없다.<li>기본적으로 모니터에 대한 동시 접근을 막기 때문에 lock을 걸 필요가 없다.</ul><li>프로세스가 모니터 안에서 기다릴 수 있도록 하기 위해 condition을 사용한다.<ul><li>condition var은 값을 가지지 않고 자신의 큐에 프로세스를 매달아서 sleep시키거나 큐에서 프로세스를 깨우는 역할만 한다.<li>condition variable은<code class="language-plaintext highlighter-rouge">wait()</code>와 <code class="language-plaintext highlighter-rouge">signal()</code> 연산을 통해서만 접근이 가능하다.<ul><li><code class="language-plaintext highlighter-rouge">x.wait()</code>: x조건을 만족하지 않으면 sleep할 때 호출 (<code class="language-plaintext highlighter-rouge">x.signal()</code>을 invoke하기 전까지 일시 중지)<li><code class="language-plaintext highlighter-rouge">x.signal()</code>: x를 다 쓰고 빠져나갈때 sleep중인 프로세스가 있으면 그 중 하나를 깨워준다. (일시중지된 프로세스를 resume)</ul></ul></ul><p><br /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cs/'>CS</a>, <a href='/categories/%EC%9A%B4%EC%98%81-%EC%B2%B4%EC%A0%9C/'>운영-체제</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cs/" class="post-tag no-text-decoration" >cs</a> <a href="/tags/%EC%9A%B4%EC%98%81-%EC%B2%B4%EC%A0%9C/" class="post-tag no-text-decoration" >운영-체제</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-Process-Synchronization+-+Hello%2C+World%21&url=https%3A%2F%2Fjaekp.github.io%2Fposts%2Foperationsystem06%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-Process-Synchronization+-+Hello%2C+World%21&u=https%3A%2F%2Fjaekp.github.io%2Fposts%2Foperationsystem06%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fjaekp.github.io%2Fposts%2Foperationsystem06%2F&text=%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-Process-Synchronization+-+Hello%2C+World%21" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/mogodb01/">MongoDB-환경설정과-간단한-CRUD구현하기</a><li><a href="/posts/performance03/">실전-웹-성능-최적화-(feat. React)-Part2</a><li><a href="/posts/performance01/">실전-웹-성능-최적화-(feat. React)-Part1</a><li><a href="/posts/nft03/">03-Solidity-문법-기초</a><li><a href="/posts/nft04/">03-DApp-web3를-이용하여-이더리움과-상호작용하기</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/til/">til</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/vue/">vue</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/moviewiki/">MovieWiki</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/operationsystem07/"><div class="card-body"> <em class="timeago small" data-ts="1663599600" > 2022-09-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>운영체제-Deadlocks</h3><div class="text-muted small"><p> 7장-Deadlocks (교착 상태) 강의 링크 1. Deadlock Problem 1) 정의 데드락이란 일련의 프로세스들이 서로가 가진 자원을 기다리며 block된 상태를 의미한다. 여기서 자원이란 하드웨어, 소프트웨어 등을 포함하는 개념 ex) I/O Device, CPU Cycle, Memory Space, Sema...</p></div></div></a></div><div class="card"> <a href="/posts/operationsystem01/"><div class="card-body"> <em class="timeago small" data-ts="1661526000" > 2022-08-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>운영체제-기본-개념</h3><div class="text-muted small"><p> 1장-운영체제-소개 1. 운영 체제란? 컴퓨터 하드웨어 바로 위에 설치되어 사용자 및 다른 모든 소프트웨어와 하드웨어를 연결하는 소프트웨어 계층 컴퓨터 안의 하드웨어랑 프로그램을 어떻게 잘 관리할 것인가. 협의의 운영체제 (커널) 운영체제의 핵심 부분으로 메모리에 상주하는 부분이다. 광의...</p></div></div></a></div><div class="card"> <a href="/posts/operationsystem02/"><div class="card-body"> <em class="timeago small" data-ts="1661526000" > 2022-08-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>운영체제-기본-구조</h3><div class="text-muted small"><p> 2장-운영체제-구조 강의 링크 1. 컴퓨터 시스템 구조 CPU 메모리에 있는 instruction을 실행한다. CPU안에는 레지스터들과 modebit이 있다. Modebit: CPU의 제어 권한이 현재 프로그램에 있는지 OS에 있는지 확인가능 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/operationsystem05/" class="btn btn-outline-primary" prompt="Older"><p>운영체제-CPU-스케쥴링</p></a> <a href="/posts/operationsystem07/" class="btn btn-outline-primary" prompt="Newer"><p>운영체제-Deadlocks</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/JaeKP">박재경</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/til/">til</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/vue/">vue</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/project/">project</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/moviewiki/">MovieWiki</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
